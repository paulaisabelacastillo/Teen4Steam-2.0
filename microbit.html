<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Laboratorio Micro:bit</title>
  <link rel="stylesheet" href="microbit.css" />
</head>
<body>
  <div class="container">
    <h1>üî¨ Laboratorio Micro:bit</h1>
    <p class="score">Puntos: <span id="score">0</span></p>
    <p class="level">Nivel: <span id="level">1</span></p>
    <button id="startBtn">¬°Comenzar!</button>
    <div class="game-area" id="gameArea"></div>
  </div>

  <script>
    const startBtn = document.getElementById("startBtn");
    const gameArea = document.getElementById("gameArea");
    const scoreDisplay = document.getElementById("score");
    const levelDisplay = document.getElementById("level");

    let score = 0;
    let level = 1;
    let interval;
    let gameTime = 20000; // 20 segundos por nivel

    function createMicrobit() {
      const goodImages = ["microbit.png", "tubo.png", "protoboard.png"];
      const badImages = ["bomba.png", "error.png"]; // a√±ade im√°genes falsas

      // Decide si es bueno o malo (20% malo a partir del nivel 2)
      let isBad = false;
      if (level >= 2 && Math.random() < 0.2 + level * 0.05) {
        isBad = true;
      }

      const imageList = isBad ? badImages : goodImages;
      const randomImage = imageList[Math.floor(Math.random() * imageList.length)];

      const img = document.createElement("img");
      img.src = randomImage;
      img.classList.add("microbit");
      
      // Tama√±o din√°mico seg√∫n nivel (m√°s dif√≠cil ‚Üí m√°s peque√±o)
      const size = Math.max(30, 60 - level * 5); 
      img.style.width = size + "px";
      
      img.style.top = Math.random() * (300 - size) + "px";
      img.style.left = Math.random() * (500 - size) + "px";

      img.onclick = () => {
        if (isBad) {
          score--; // penalizaci√≥n
          alert("¬°Oh no! Hiciste clic en un objeto peligroso üòÆ");
        } else {
          score++;
        }
        scoreDisplay.textContent = score;
        img.remove();
      };

      gameArea.appendChild(img);
    }

    function startLevel() {
      gameArea.innerHTML = "";
      scoreDisplay.textContent = score;
      levelDisplay.textContent = level;

      // Intervalo m√°s r√°pido en niveles altos
      let intervalTime = Math.max(300, 1000 - (level - 1) * 100);
      clearInterval(interval);

      // Aparecen m√°s im√°genes simult√°neamente en niveles altos
      interval = setInterval(() => {
        for (let i = 0; i < level; i++) { // cada nivel genera m√°s im√°genes
          createMicrobit();
        }
      }, intervalTime);

      setTimeout(() => {
        clearInterval(interval);
        alert("¬°Nivel " + level + " terminado! Puntos: " + score);
        level++;
        guardarPuntaje(score, level);
        if (level <= 5) {
          startLevel();
        } else {
  alert("¬°Felicidades! Has completado todos los niveles üéâ");
  guardarPuntaje(score, level);
}
      }, gameTime);
    }

    startBtn.onclick = () => {
      level = 1;
      score = 0;
      startLevel();
    };
  </script>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

<script>
 const firebaseConfig = {
  apiKey: "AIzaSyDzhvEZsjnFVD237Gen7frLii6RdvApB7g",
  authDomain: "teen4steam-64958.firebaseapp.com",
  projectId: "teen4steam-64958",
  storageBucket: "teen4steam-64958.firebasestorage.app",
  messagingSenderId: "840465508724",
  appId: "1:840465508724:web:8e5f60a81ecb8e549da421",
  measurementId: "G-Y03XVR5EES"
};

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ‚úÖ Aqu√≠ pones la funci√≥n guardarPuntaje
  function guardarPuntaje(score, level) {
    db.collection("puntuaciones").add({
      puntos: score,
      nivelAlcanzado: level,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
      console.log("‚úÖ Puntos guardados en Firebase");
    }).catch((error) => {
      console.error("‚ùå Error al guardar en Firebase:", error);
    });
  }
</script>

<script>
  const translations = {
    es: {
      title: "üî¨ Laboratorio Micro:bit",
      start: "¬°Comenzar!",
      puntos: "Puntos",
      nivel: "Nivel",
      peligro: "¬°Oh no! Hiciste clic en un objeto peligroso üòÆ",
      nivelTerminado: nivel => `¬°Nivel ${nivel} terminado! Puntos: `,
      fin: "¬°Felicidades! Has completado todos los niveles üéâ"
    },
    en: {
      title: "üî¨ Micro:bit Lab",
      start: "Start!",
      puntos: "Score",
      nivel: "Level",
      peligro: "Oh no! You clicked a dangerous object üòÆ",
      nivelTerminado: level => `Level ${level} completed! Score: `,
      fin: "Congratulations! You've completed all levels üéâ"
    }
  };

  let currentLang = localStorage.getItem("lang") || "es";

  function aplicarTraduccion(lang) {
    const t = translations[lang];
    document.querySelector("h1").textContent = t.title;
    document.getElementById("startBtn").textContent = t.start;
    document.querySelector(".score").childNodes[0].textContent = t.puntos + ": ";
    document.querySelector(".level").childNodes[0].textContent = t.nivel + ": ";
  }

  document.getElementById("langToggle").addEventListener("click", () => {
    currentLang = currentLang === "es" ? "en" : "es";
    localStorage.setItem("lang", currentLang);
    aplicarTraduccion(currentLang);
  });

  aplicarTraduccion(currentLang);

  // ‚ö†Ô∏è Reemplaza los textos en JS din√°micamente
  function traducirAlertaPeligro() {
    return translations[currentLang].peligro;
  }

  function traducirNivelTerminado(nivel) {
    return translations[currentLang].nivelTerminado(nivel);
  }

  function traducirFin() {
    return translations[currentLang].fin;
  }
</script>


</body>
</html>